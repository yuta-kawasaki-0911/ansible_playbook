!Configuration File for keepalived

global_defs {
   notification_email {
     dsp_infra@fullspeed.co.jp
   }
   notification_email_from Alexandre.Cassen@firewall.loc
   smtp_connect_timeout 30
   router_id LVS_DEVEL
}

vrrp_instance vip_3pas {
interface em1
virtual_router_id 80
state BACKUP
nopreempt

virtual_ipaddress {
202.131.200.80/26 dev em1
202.131.200.81/26 dev em1
202.131.200.85/26 dev em1
192.168.134.20/24 dev em2
}
}


virtual_server 202.131.200.80 80 {
delay_loop 3
lvs_sched rr
lvs_method NAT
protocol TCP

real_server 192.168.134.80 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 3
}
}

real_server 192.168.134.81 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 3
}
}

real_server 192.168.134.82 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 3
}
}
}

virtual_server 202.131.200.81 80 {
delay_loop 3
lvs_sched rr
lvs_method NAT
protocol TCP

real_server 192.168.134.100 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}

real_server 192.168.134.101 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}

real_server 192.168.134.102 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}

real_server 192.168.134.103 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}

real_server 192.168.134.104 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}

real_server 192.168.134.105 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}

real_server 192.168.134.106 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}

real_server 192.168.134.107 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}

}

virtual_server 202.131.200.81 7777 {
delay_loop 3
lvs_sched rr
lvs_method NAT
protocol TCP

real_server 192.168.134.100 7777 {
weight 1
inhibit_on_failure
connect_port 7777
connect_timeout 10
}
}


virtual_server 202.131.200.80 443 {
delay_loop 3
lvs_sched rr
lvs_method NAT
protocol TCP

real_server 192.168.134.80 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 3
}
}

real_server 192.168.134.81 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 3
}
}

real_server 192.168.134.82 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 3
}
}
}

virtual_server 202.131.200.81 443 {
delay_loop 3
lvs_sched rr
lvs_method NAT
protocol TCP

real_server 192.168.134.100 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}

real_server 192.168.134.101 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}

real_server 192.168.134.102 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}

real_server 192.168.134.103 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}

real_server 192.168.134.104 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}

real_server 192.168.134.105 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}

real_server 192.168.134.106 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}

real_server 192.168.134.107 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}
}


virtual_server 202.131.200.85 80 {
delay_loop 3
lvs_sched rr
lvs_method NAT
protocol TCP

real_server 192.168.134.170 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}

real_server 192.168.134.171 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}
}

virtual_server 202.131.200.85 443 {
delay_loop 3
lvs_sched rr
lvs_method NAT
protocol TCP

real_server 192.168.134.170 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 3
}
}

real_server 192.168.134.171 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 3
}
}
}


virtual_server 192.168.134.20 {
delay_loop 3
lvs_sched rr
lvs_method NAT
protocol TCP

real_server 192.168.134.10  {
weight 1
inhibit_on_failure
connect_port 22
connect_timeout 3
}

real_server 192.168.134.11 {
weight 1
inhibit_on_failure
connect_port 22
connect_timeout 3
}
}
}

