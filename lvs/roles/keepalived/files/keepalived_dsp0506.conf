!Configuration File for keepalived

global_defs {
   notification_email {
     dsp_infra@fullspeed.co.jp
   }
   notification_email_from dsp_infra@fullspeed.co.jp
   smtp_connect_timeout 90
   router_id LVS_DEVEL
}

vrrp_instance vip_dsp2 {
interface em1
virtual_router_id 90
state BACKUP
nopreempt


virtual_ipaddress {
202.131.200.71/24 dev em1
202.131.200.72/24 dev em1
202.131.200.74/24 dev em1
202.131.200.88/24 dev em1
192.168.199.30/24 dev em2
}
}


virtual_server 202.131.200.71 80 {
delay_loop 3
lvs_sched rr
lvs_method NAT
protocol TCP

real_server 192.168.199.100 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}
}


virtual_server 202.131.200.71 443 {
delay_loop 3
lvs_sched rr
lvs_method NAT
protocol TCP

real_server 192.168.199.100 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}
}

virtual_server 192.168.199.30 {
delay_loop 3
lvs_sched rr
lvs_method NAT
protocol TCP

real_server 192.168.199.31  {
weight 1
inhibit_on_failure
connect_port 22
connect_timeout 3
}

real_server 192.168.199.32 {
weight 1
inhibit_on_failure
connect_port 22
connect_timeout 10
}
}


virtual_server 202.131.200.72 80 {
delay_loop 3
lvs_sched rr
lvs_method NAT
protocol TCP

real_server 192.168.199.110 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}

real_server 192.168.199.111 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}

real_server 192.168.199.112 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}

real_server 192.168.199.113 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}
}

virtual_server 202.131.200.74 80 {
delay_loop 3
lvs_sched rr
lvs_method NAT
protocol TCP

real_server 192.168.199.150 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}

real_server 192.168.199.151 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}

real_server 192.168.199.152 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}

real_server 192.168.199.159 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}

}

virtual_server 202.131.200.88 80 {
delay_loop 3
lvs_sched rr
lvs_method NAT
protocol TCP

real_server 192.168.199.86 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}

real_server 192.168.199.87 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}

}


virtual_server 202.131.200.72 443 {
delay_loop 3
lvs_sched rr
lvs_method NAT
protocol TCP

real_server 192.168.199.110 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}

real_server 192.168.199.111 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}

real_server 192.168.199.112 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}

real_server 192.168.199.113 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}
}

virtual_server 202.131.200.74 443 {
delay_loop 3
lvs_sched rr
lvs_method NAT
protocol TCP

real_server 192.168.199.150 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}

real_server 192.168.199.151 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}

real_server 192.168.199.152 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}

real_server 192.168.199.159 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}

}

virtual_server 202.131.200.88 443 {
delay_loop 3
lvs_sched rr
lvs_method NAT
protocol TCP

real_server 192.168.199.86 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}

real_server 192.168.199.87 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}

}
