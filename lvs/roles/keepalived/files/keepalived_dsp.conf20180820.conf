!Configuration File for keepalived

global_defs {
   notification_email {
     dsp_infra@fullspeed.co.jp
   }
   notification_email_from dsp_infra@fullspeed.co.jp
   smtp_connect_timeout 30
   router_id LVS_DEVEL
}

vrrp_instance vip_dsp {
interface bond0
virtual_router_id 70
state BACKUP
nopreempt


virtual_ipaddress {
202.131.200.70/24 dev bond0
202.131.200.71/24 dev bond0
202.131.200.72/24 dev bond0
202.131.200.74/24 dev bond0
192.168.199.20/24 dev bond1
}
}


virtual_server 202.131.200.70 80 {
delay_loop 3
lvs_sched rr
lvs_method NAT
protocol TCP

real_server 192.168.199.170 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}

real_server 192.168.199.171 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}

real_server 192.168.199.172 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}

real_server 192.168.199.173 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}

real_server 192.168.199.174 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}

real_server 192.168.199.175 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}

real_server 192.168.199.176 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}

real_server 192.168.199.177 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}

real_server 192.168.199.178 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}

real_server 192.168.199.179 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}

real_server 192.168.199.180 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}

real_server 192.168.199.181 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}

real_server 192.168.199.182 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}

real_server 192.168.199.183 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}

real_server 192.168.199.184 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}

real_server 192.168.199.185 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}

real_server 192.168.199.186 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}

real_server 192.168.199.187 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}

real_server 192.168.199.188 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}

real_server 192.168.199.189 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}

real_server 192.168.199.190 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}

real_server 192.168.199.191 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}

real_server 192.168.199.192 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}

real_server 192.168.199.193 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}

real_server 192.168.199.194 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}

real_server 192.168.199.195 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}

}


virtual_server 202.131.200.71 80 {
delay_loop 3
lvs_sched rr
lvs_method NAT
protocol TCP

real_server 192.168.199.100 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}
}


virtual_server 202.131.200.70 443 {
delay_loop 3
lvs_sched rr
lvs_method NAT
protocol TCP

real_server 192.168.199.170 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}

real_server 192.168.199.171 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}

real_server 192.168.199.172 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}

real_server 192.168.199.173 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}

real_server 192.168.199.174 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}

real_server 192.168.199.175 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}

real_server 192.168.199.176 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}

real_server 192.168.199.177 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}

real_server 192.168.199.178 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}

real_server 192.168.199.179 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}

real_server 192.168.199.180 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}

real_server 192.168.199.181 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}

real_server 192.168.199.182 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}

real_server 192.168.199.183 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}

real_server 192.168.199.184 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}

real_server 192.168.199.185 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}

real_server 192.168.199.186 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}

real_server 192.168.199.187 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}

real_server 192.168.199.188 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}

real_server 192.168.199.189 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}

real_server 192.168.199.190 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}

real_server 192.168.199.191 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}

real_server 192.168.199.192 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}

real_server 192.168.199.193 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}

real_server 192.168.199.194 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}

real_server 192.168.199.195 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}

}

virtual_server 202.131.200.71 443 {
delay_loop 3
lvs_sched rr
lvs_method NAT
protocol TCP

real_server 192.168.199.100 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}
}

virtual_server 192.168.199.20 {
delay_loop 3
lvs_sched rr
lvs_method NAT
protocol TCP

real_server 192.168.199.162  {
weight 1
inhibit_on_failure
connect_port 22
connect_timeout 3
}


real_server 192.168.199.163 {
weight 1
inhibit_on_failure
connect_port 22
connect_timeout 10
}
}


virtual_server 202.131.200.72 80 {
delay_loop 3
lvs_sched rr
lvs_method NAT
protocol TCP

real_server 192.168.199.110 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}

real_server 192.168.199.111 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}

real_server 192.168.199.112 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}

real_server 192.168.199.113 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}
}

virtual_server 202.131.200.74 80 {
delay_loop 3
lvs_sched rr
lvs_method NAT
protocol TCP

real_server 192.168.199.150 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}

real_server 192.168.199.151 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}

real_server 192.168.199.152 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}

real_server 192.168.199.159 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 10
}
}

}


virtual_server 202.131.200.72 443 {
delay_loop 3
lvs_sched rr
lvs_method NAT
protocol TCP

real_server 192.168.199.110 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}

real_server 192.168.199.111 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}

real_server 192.168.199.112 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}

real_server 192.168.199.113 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}
}

virtual_server 202.131.200.74 443 {
delay_loop 3
lvs_sched rr
lvs_method NAT
protocol TCP

real_server 192.168.199.150 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}

real_server 192.168.199.151 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}

real_server 192.168.199.152 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}

real_server 192.168.199.159 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 10
}
}

}

