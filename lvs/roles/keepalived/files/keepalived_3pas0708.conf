!Configuration File for keepalived

global_defs {
   notification_email {
     dsp_infra@fullspeed.co.jp
   }
   notification_email_from Alexandre.Cassen@firewall.loc
   smtp_connect_timeout 30
   router_id LVS_DEVEL
}

vrrp_instance vip_3pas2 {
interface em1
virtual_router_id 100
state BACKUP
nopreempt

virtual_ipaddress {
202.131.200.82/26 dev em1
202.131.200.84/26 dev em1
202.131.200.86/26 dev em1
192.168.134.50/24 dev em2
}
}


virtual_server 202.131.200.82 80 {
delay_loop 3
lvs_sched rr
lvs_method NAT
protocol TCP

real_server 192.168.134.200 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 3
}
}

real_server 192.168.134.201 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 3
}
}

real_server 192.168.134.202 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 3
}
}

real_server 192.168.134.203 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 3
}
}

real_server 192.168.134.208 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 3
}
}

real_server 192.168.134.209 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 3
}
}

real_server 192.168.134.210 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 3
}
}

real_server 192.168.134.211 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 3
}
}

}



virtual_server 202.131.200.82 443 {
delay_loop 3
lvs_sched rr
lvs_method NAT
protocol TCP

real_server 192.168.134.200 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 3
}
}

real_server 192.168.134.201 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 3
}
}

real_server 192.168.134.202 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 3
}
}

real_server 192.168.134.203 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 3
}
}

real_server 192.168.134.208 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 3
}
}

real_server 192.168.134.209 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 3
}
}

real_server 192.168.134.210 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 3
}
}

real_server 192.168.134.211 443 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 443
connect_timeout 3
}
}

}


virtual_server 202.131.200.84 80 {
delay_loop 3
lvs_sched rr
lvs_method NAT
protocol TCP

real_server 192.168.134.200 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 3
}
}

real_server 192.168.134.201 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 3
}
}

real_server 192.168.134.202 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 3
}
}

real_server 192.168.134.203 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 3
}
}

real_server 192.168.134.208 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 3
}
}

real_server 192.168.134.209 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 3
}
}

real_server 192.168.134.210 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 3
}
}

real_server 192.168.134.211 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 3
}
}

}


virtual_server 202.131.200.84 443 {
delay_loop 3
lvs_sched rr
lvs_method NAT
protocol TCP

real_server 192.168.134.200 444 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 444
connect_timeout 3
}
}

real_server 192.168.134.201 444 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 444
connect_timeout 3
}
}

real_server 192.168.134.202 444 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 444
connect_timeout 3
}
}

real_server 192.168.134.203 444 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 444
connect_timeout 3
}
}

real_server 192.168.134.208 444 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 444
connect_timeout 3
}
}

real_server 192.168.134.209 444 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 444
connect_timeout 3
}
}

real_server 192.168.134.210 444 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 444
connect_timeout 3
}
}

real_server 192.168.134.211 444 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 444
connect_timeout 3
}
}

}


virtual_server 202.131.200.86 80 {
delay_loop 3
lvs_sched rr
lvs_method NAT
protocol TCP

real_server 192.168.134.200 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 3
}
}

real_server 192.168.134.201 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 3
}
}

real_server 192.168.134.202 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 3
}
}

real_server 192.168.134.203 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 3
}
}

real_server 192.168.134.208 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 3
}
}

real_server 192.168.134.209 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 3
}
}

real_server 192.168.134.210 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 3
}
}

real_server 192.168.134.211 80 {
weight 1
inhibit_on_failure
HTTP_GET {
url {
path /health.html
status_code 200
}
connect_port 80
connect_timeout 3
}
}

}


virtual_server 202.131.200.86 443 {
delay_loop 3
lvs_sched rr
lvs_method NAT
protocol TCP

real_server 192.168.134.200 445 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 445
connect_timeout 3
}
}

real_server 192.168.134.201 445 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 445
connect_timeout 3
}
}

real_server 192.168.134.202 445 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 445
connect_timeout 3
}
}

real_server 192.168.134.203 445 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 445
connect_timeout 3
}
}

real_server 192.168.134.208 445 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 445
connect_timeout 3
}
}

real_server 192.168.134.209 445 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 445
connect_timeout 3
}
}

real_server 192.168.134.210 445 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 445
connect_timeout 3
}
}

real_server 192.168.134.211 445 {
weight 1
inhibit_on_failure
SSL_GET {
url {
path /health.html
status_code 200
}
connect_port 445
connect_timeout 3
}
}
}



virtual_server 192.168.134.50 {
delay_loop 3
lvs_sched rr
lvs_method NAT
protocol TCP

real_server 192.168.134.51  {
weight 1
inhibit_on_failure
connect_port 22
connect_timeout 3
}

real_server 192.168.134.52 {
weight 1
inhibit_on_failure
connect_port 22
connect_timeout 3
}
}
}

